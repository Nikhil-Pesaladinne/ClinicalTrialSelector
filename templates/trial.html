{% extends "patient.html" %}

{%- set id = request.args.get('id', '0') %}
{%- set ns = namespace(trial=none) %}
{%- for tr in session["trials"] %}
    {%- if tr.id == id %}
        {%- set ns.trial = tr %}
    {% endif %}
{% endfor %}

{% macro section(section_name, section_header, section_content, parent="info") %}
<ul class="usa-accordion">
  <li>
    <button class="usa-accordion-button"
      aria-expanded="false"
      aria-controls="{{section_name}}">
      {{section_header}}
    </button>
    <div id="{{section_name}}" class="usa-accordion-content">
         {{section_content}}
    </div>
  </li>
</ul>

{% endmacro %}

{% block title %}
    Clinical Trials Browser
{% endblock %}

{% block header %}
    Browse Trial # {{id}}
{% endblock %}

{% block extra_button %}
<div class="col">
<span class="float-right">
    <a class="btn btn-primary" href="/">All Trials</a>
</span>	
</div>
{% endblock %}

{% block pt_main %}
    <section class="usa-banner">
        <div class=".usa-accordion">
            <header class="usa-banner-header">
                <button class=".usa-accordion-button" aria-expanded="false" href="#info" data-toggle="tab">Info</button>
                <button class=".usa-accordion-button" aria-expanded="false" href="#measures" data-toggle="tab">Outcome Measures</button>
                <button class=".usa-accordion-button" aria-expanded="false" href="#diseases" data-toggle="tab">Diseases</button>
                <button class=".usa-accordion-button" aria-expanded="false" href="#locations" data-toggle="tab">Locations</button>
           </header>
    </div>
</section>
        
    <div class="tab-content">
        <div class="tab-pane active" id="info">
            <br>
            {{ section("title", "Brief Title", ns.trial.title) }}
            {{ section("pi", "Principal Investigator", ns.trial.pi) }}
            {{ section("official", "Official Title", ns.trial.official) }}
            {%- if ns.trial.population["population"] %}
                {{ section("population", "Target Population", ns.trial.population)}}
            {% endif %}
            {{ section("summary", "Summary", ns.trial.summary) }}
            {{ section("description", "Detailed Description", ns.trial.description) }}
        </div><!--/tab-pane-->
        <div class="tab-pane" id="measures">
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Timeframe</th>
                    </tr>
                </thead>

                {%- for measure in ns.trial.measures %}

                    <tbody class="usa-accordion">
                        <tr>
                           <td colspan="2" class="page-header">
                               <!-- button type="button" class="tbtn"><i class="fa fa-plus-circle"></i> {{measure["name"]}}</button -->
                               <button class="usa-accordion-button"
                                  aria-expanded="false"
                                  aria-controls="{{ loop.index0 }}">
                                  {{measure["name"]}}
                                </button>
                           </td>
                          </tr>

                                <tr id="{{ loop.index0 }}" class="usa-accordion-content">
                                    <td>{{ measure["description"] }}</td>
                                    <td>{{ measure["timeframe"] }}</td>
                                </tr>

                    </tbody>

                {%- endfor %}
            </table>
        
        </div><!--/tab-pane-->
        <div class="tab-pane" id="diseases">
                <table class="custom-table">
                        <thead>
                            <tr>
                                <th>NCIT Code</th>
                                <th>Inclusion Indicator</th>
                            </tr>
                        </thead>
        
                        {%- for disease in ns.trial.diseases %}
                            <tbody class="usa-accordion">
                                <tr>
                                   <td colspan="2" class="page-header">
                                        <button class="usa-accordion-button" aria-expanded="false" aria-controls="{{ loop.index0 }}"> {{disease["preferred_name"]}} </button>
                                   </td>
                                </tr>
                                        <tr id="{{ loop.index0 }}" class="usa-accordion-content">
                                            <td>{{ disease["nci_thesaurus_concept_id"] }}</td>
                                            <td>{{ disease["inclusion_indicator"] }}</td>
                                        </tr>
                            </tbody>
                        {%- endfor %}
                    </table>
        
        </div><!--/tab-pane-->
        <div class="tab-pane" id="locations">
                <table class="custom-table">
                        <thead>
                            <tr>
                                <th>Address</th>
                                <th>Phone</th>
                                <th>Status</th>
                            </tr>
                        </thead>
        
                        {%- for site in ns.trial.sites %}
                            <tbody class="usa-accordion">
                                <tr>
                                     <td colspan="3" class="page-header">
                                     <button class="usa-accordion-button" aria-expanded="false" aria-controls="{{ loop.index0 }}"> {{site["org_name"]}}</button>
                                     </td>
                                </tr>
                                        <tr id="{{ loop.index0 }}" class="usa-accordion-content">
                                            <td> {{ site["org_address_line_1"] }}<br>
                                                {%- if site["org_address_line_2"] %}
                                                    {{ site["org_address_line_2"] }}<br>
                                                {%- endif %}
                                                {{ site["org_city"]}}, {{ site["org_state_or_province"] }} {{ site["org_postal_code"]}}
                                            </td>
                                            <td>{{ site["org_phone"] }}</td>
                                            <td>{{ site["org_status"] }}</td>
                                        </tr>
                            </tbody>
                        {%- endfor %}
                    </table>
        
        </div><!--/tab-pane-->
    </div><!--/tab-content-->

{% endblock %}