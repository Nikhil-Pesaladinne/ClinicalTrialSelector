{% extends "base.html" %}

{%- set trailId = request.args.get('id', '0') %}
{%- set trailns = namespace(trial=none) %}
{%- for tr in session["trials"] %}
    {%- if tr.id == trailId %}
        {%- set trailns.trial = tr %}
    {% endif %}
{% endfor %}

{% block content %}

{%- if trailId != '0' %}
    <header class="site-header" role="banner">

      <div class="site-l-wrapper">
        <div class="site-header__masthead">
          <div class="site-header__logo" id="extended-logo">
            <em class="site-header__logo-text">
              <a class="site-header__logo-link" title="Clinical Trials Broweser" href="#"><strong class="vads-u-display--block small-screen:vads-u-display--inline">Browse Trial # {{trailId}}</strong> </a>
            </em>
          </div>
            <div class="site-header__logo" id="extended-logo">
                <a href="/" class="usa-button vads-u-margin--1">All Trails</a>
            </div>
          <div class="site-header__utility-links">

            <a href="/infected_patients" class="usa-button vads-u-margin--1">Matcher for Doctors</a>
              <a href="/logout" class="usa-button vads-u-margin--1">Logout</a>
          </div>
        </div>
      </div>
    </header>
    <div class="site-top-nav-wrapper site-l-wrapper sticky">
      <nav class="site-header__nav">
        <ul class="site-header__nav-list">
          <li class="site-header__nav-item">
            <a class="site-header__nav-item__link " href="#info" data-toggle="tab">Info</a>
          </li>
            <li class="site-header__nav-item">
                <a class="site-header__nav-item__link " href="#measures" data-toggle="tab">Outcome Measures</a>
            </li>
          <li class="site-header__nav-item">
            <a class="site-header__nav-item__link " href="#diseases" data-toggle="tab">Diseases</a>
          </li>
          <li class="site-header__nav-item">
            <a class="site-header__nav-item__link " href="#locations" data-toggle="tab">Locations</a>
          </li>
        </ul>
      </nav>
    </div>
{% else %}
    <header class="site-header" role="banner">

      <div class="site-l-wrapper">
        <div class="site-header__masthead">
          <div class="site-header__logo" id="extended-logo">
            <em class="site-header__logo-text">
              <a class="site-header__logo-link" title="Clinical Trials Selector homepage" href="/"><strong class="vads-u-display--block small-screen:vads-u-display--inline">Clinical Trials Selector</strong> </a>
            </em>
          </div>
          <div class="site-header__utility-links">

            <a href="/infected_patients" class="usa-button vads-u-margin--1">Matcher for Doctors</a>
              <a href="/logout" class="usa-button vads-u-margin--1">Logout</a>
          </div>
        </div>
      </div>
    </header>
    <div class="site-top-nav-wrapper site-l-wrapper sticky">
      <nav class="site-header__nav">
        <ul class="site-header__nav-list">
          <li class="site-header__nav-item">
            <a class="site-header__nav-item__link " href="#trials" data-toggle="tab">Trails</a>
          </li>
            {%- if session["excluded"] %}
            <li class="site-header__nav-item">
                <a class="site-header__nav-item__link " href="#Excluded" data-toggle="tab">Excluded</a>
            </li>
        {% endif %}
          <li class="site-header__nav-item">
            <a class="site-header__nav-item__link " href="#conditions" data-toggle="tab">Conditions w/o Trials</a>
          </li>
          <li class="site-header__nav-item">
            <a class="site-header__nav-item__link " href="#matches" data-toggle="tab">Code Matches</a>
          </li>
          <li class="site-header__nav-item">
            <a class="site-header__nav-item__link " href="#nomatches" data-toggle="tab">Codes w/o Matches</a>
          </li>
            {%- if session["combined_patient"] and session["combined_patient"].loaded %}
          <li class="site-header__nav-item">
            <a class="site-header__nav-item__link " href="/download_trials" data-toggle="tab">Download Trials</a>
          </li>
            {% endif %}
        </ul>
      </nav>
    </div>
{% endif %}


    <div class="container bootstrap snippet">
        <div class="row">
            <div class="col-sm-9">
                <h1>{% block header %}{% endblock %}</h1>
            </div>
            <div class="col">
                <span class="float-left">
                    <!-- a class="btn btn-primary" href="/infected_patients">Matcher for Doctors</a -->
                    <!-- a class="usa-button" href="/infected_patients">Matcher for Doctors</a -->
                </span>
            </div>
			{% block extra_button %}{% endblock%}
            <div class="col">
						<span class="float-right">

                            <!-- a class="usa-button" href="/logout">Logout</a -->
                    </span>
            </div>
        </div>
    </div>

    <div class="vads-l-row vads-u-padding-x--3">
      <div class="vads-l-col--3 vads-u-padding-x--3">
        {%- for source in ["va", "cms"] %}
         <table>
            <thead>
              <tr>
                <th class="vads-u-display--flex vads-u-justify-content--space-between">
                  <div class="vads-u-flex--auto">{{ source.upper() }} Patient Info</div>
                  {%- if not session[source+"_patient"] %}
                    <div class="vads-u-flex--auto"><a href="/{{source}}/authenticate" class="vads-u-margin--0 usa-button">Login</a></div>
                  {% endif %}
                </th>
              </tr>
            </thead>
            <tbody>
              {%- for label, value in {
                "Name":session[source+"_name"], 
                "ID":session[source+"_patient"], 
                "DOB":session[source+"_birthdate"], 
                "Gender":session[source+"_gender"],
                "Zipcode":session[source+"_zipcode"]}.items() %}
                <tr>
                  <td class="vads-u-display--flex vads-u-justify-content--space-between vads-u-flex-wrap--wrap">
                    <div class="vads-u-flex--auto"><strong>{{label}}</strong></div>
                    <div class="vads-u-flex--auto">{{value}}</div>
                  </td>
                </tr>
              {%- endfor %}
            </tbody>
         </table>
        {%- endfor %}
      </div>
      <div class="vads-l-col--8">
        <main>
          {% block pt_main %}{% endblock %}
        </main>
      </div>
    </div>
{% endblock %}
