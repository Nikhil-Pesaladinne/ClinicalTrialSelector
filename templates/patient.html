{% extends "base.html" %}


{% block content %}
  {{ super() }}

  {% set ns = namespace() %}
  {% set trialID = request.args.get('id', '0') %}
  {% set ns.combined = session['combined_patient'] if session['combined_patient'] else none %}
  <header class="site-header" role="banner">
    <div class="site-l-wrapper">
      <div class="site-header__masthead">
        <div class="site-header__logo" id="extended-logo">
          <em class="site-header__logo-text">
            <a class="site-header__logo-link" title="Clinical Trial Selector" href="/">
              <strong class="vads-u-display--block small-screen:vads-u-display--inline">
                Clinical Trial Selector
              </strong>
              {% if trialID != '0' %}
                | Browse Trial # {{trialID}}
              {% endif %}
            </a>
          </em>
        </div>
        {% if trialID != '0' %}
          <div class="site-header__logo" id="extended-logo">
            <a href="/" class="usa-button vads-u-margin--1">All Trials</a>
          </div>
        {% endif %}
        <div class="site-header__utility-links">
          <!-- <a href="/infected_patients" class="usa-button vads-u-margin--1">Matcher for Doctors</a> -->
          <form action="{{ url_for('logout') }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button class="usa-button vads-u-margin--0" type="submit">Logout</button>
          </form>
        </div>
      </div>
    </div>
  </header>

  <div>

    {% if trialID != '0' %}    
      <div class="site-top-nav-wrapper site-l-wrapper sticky">
        <nav class="site-header__nav">
          <ul class="site-header__nav-list">
            <li class="site-header__nav-item">
              <a class="site-header__nav-item__link {{ trial_selection }}" href="/trial?id={{trialID}}" data-toggle="tab">Info</a>
            </li>
              <li class="site-header__nav-item">
                  <a class="site-header__nav-item__link {{ measures_selection }}" href="/measures?id={{trialID}}" data-toggle="tab">Outcome Measures</a>
              </li>
            <li class="site-header__nav-item">
              <a class="site-header__nav-item__link {{ diseases_selection }}" href="/diseases?id={{trialID}}" data-toggle="tab">Diseases</a>
            </li>
            <li class="site-header__nav-item">
              <a class="site-header__nav-item__link {{ locations_selection }}" href="/locations?id={{trialID}}" data-toggle="tab">Locations</a>
            </li>
          </ul>
        </nav>
      </div>
    {% else %}
      <div class="site-top-nav-wrapper site-l-wrapper sticky">
        <nav class="site-header__nav">
          <ul class="site-header__nav-list">
            <li class="site-header__nav-item">
              <a class="site-header__nav-item__link {{ welcome_selection }}" href="/welcome" data-toggle="tab">Welcome</a>
            </li>
            <li class="site-header__nav-item">
              <a class="site-header__nav-item__link {{ trials_selection }}" href="/trials" data-toggle="tab">Trials</a>
            </li>
            {% if session["excluded"] %}
              <li class="site-header__nav-item">
                <a class="site-header__nav-item__link {{ excluded_selection }}" href="/excluded" data-toggle="tab">Excluded</a>
              </li>
            {% endif %}
            <li class="site-header__nav-item">
              <a class="site-header__nav-item__link {{ conditions_selection }}" href="/conditions" data-toggle="tab">Conditions w/o Trials</a>
            </li>
            <li class="site-header__nav-item">
              <a class="site-header__nav-item__link {{ matches_selection }}" href="matches" data-toggle="tab">Code Matches</a>
            </li>
            <li class="site-header__nav-item">
              <a class="site-header__nav-item__link {{ nomatches_selection }}" href="/nomatches" data-toggle="tab">Codes w/o Matches</a>
            </li>
            {% if ns.combined.loaded %}
              <li class="site-header__nav-item">
                <a class="site-header__nav-item__link " href="/download_trials" data-toggle="tab">Download Trials</a>
              </li>
            {% endif %}
         </ul>
        </nav>
      </div>
    {% endif %}

    <div class="site-content vads-u-margin-bottom--9 vads-l-row vads-u-padding-x--3">
      <div class="site-content__nav vads-l-col--3 vads-u-padding-x--3">

        {% for source in ["va", "cms", "fb"] %}
          {% set patient = ns.combined.from_source[source] if ns.combined and ns.combined.from_source[source] else none %}
          <table>
            <thead>
              <tr>
                <th class="vads-u-display--flex vads-u-justify-content--space-between">
                  <div class="vads-u-flex--auto">{{ source.upper() }} Patient Info</div>
                  {% if not patient %}
                    <form action="{{ url_for('authenticate',source=source) }}" method="POST" class="vads-u-flex-auto">
                      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                      <button class="usa-button vads-u-margin--0" type="submit">Login</button>
                    </form>
                  {% endif %}
                </th>
              </tr>
            </thead>
            <tbody class="vads-u-line-height--1">
             {% for label, value in {
                "Name": patient.name,
                "ID": patient.mrn,
                "DOB": patient.birthdate,
                "Gender": patient.gender,
                "Zipcode": patient.zipcode}.items() %}
                <tr>
                  <td class="vads-u-display--flex vads-u-justify-content--space-between vads-u-flex-wrap--wrap vads-u-padding-y--1p5">
                    <div class="vads-u-flex--auto"><strong>{{label}}</strong></div>
                    <div class="vads-u-flex--auto">{{value}}</div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
         </table>
        {% endfor %}
      </div>
      <div class="site-content__content vads-l-col--8 vads-u-padding--3">
        <main>
          {% block pt_main scoped %}{% endblock %}
        </main>
      </div>
    </div>
  
  </div>
{% endblock %}
