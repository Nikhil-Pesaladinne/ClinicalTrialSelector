{% extends "patient.html" %}

{% block title %}
    Clinical Trials Selector
{% endblock %}

{% block header %}
    Clinical Trials Selector
{% endblock %}

{% block pt_main %}
    <ul class="nav nav-tabs" id="myTab">
        <li class="nav-item active"><a class="nav-link active" href="#trials" data-toggle="tab">Trials</a></li>
        <li class="nav-item"><a class="nav-link" href="#conditions" data-toggle="tab">Conditions w/o Trials</a></li>
    </ul> 
            
    <div class="tab-content">
        <div class="tab-pane active" id="trials">
            <br>
            {%- if session["trials"] %}
				Total Trials: {{session['numTrials']}}
				<br>
                <table class="custom-table">
                    <thead>
                        <tr>
                            <th>Trial Id</th>
                            <th>Title</th>
                        </tr>
                    </thead>

                    {%- for code in session["codes"] %}
                        <tbody>
                            {%- set ns = namespace(found=false) %}
                            {%- for trial in session["trials"] %}
                                {%- if trial.code_ncit==code["ncit"] %}
                                    {%- if ns.found==false %}
                                        <tr>
                                            <td colspan="2" class="page-header"><button type="button" class="tbtn"><i class="fa fa-plus-circle"></i> Â  Trials for condition: {{ code["ncit_desc"] }} ({{code["ncit"]}})</button> </td>
                                        </tr>
                                    {% endif %}
                                    {%- set ns.found = true %}
                                    <tr class="toggler">
                                        <td><a href="/trial?id={{ trial.id }}">{{ trial.id }}</a></td>
                                        <td>{{ trial.title }}</td>
                                    </tr>
                                {%- endif %}
                            {%- endfor %}
                        </tbody>
                    {%- endfor %}
                </table>
            {% else %}
                <a class="btn btn-primary" href="/getInfo">Find Clinical Trials</a>
            {% endif %}
        </div><!--/tab-pane-->
        <div class="tab-pane" id="conditions">
            <br>
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Condition</th>
                        <th>Code</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code in session["codes"] %}
                        {%- set ns = namespace(found = false) %}
                        {%- for trial in session["trials"] %}
                            {%- if trial.code_ncit==code["ncit"] %}
                                {%- set ns.found = true %}
                            {%- endif %}
                        {%- endfor %}
                        {%- if ns.found==false %}
                            <tr>
                                <td class="page-header">{{ code["ncit_desc"] }}</td>
                                <td class="page-header">{{ code["ncit"] }}</td>
                            </tr>
                        {%- endif %}
                    {%- endfor %}
                </tbody>
            </table>
        </div><!--/tab-pane-->
    </div><!--/tab-content-->


{% endblock %}